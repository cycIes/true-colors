{% extends "base.html" %}

{% block title %}
    Play
{% endblock %}

{% block content %}
    <div class="content p-3">
        <h1>Hexdle</h1>
        <div id="toolbar">
            <button type="button" data-bs-toggle="modal" data-bs-target="#instructions" class="clean-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle-fill" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>
                </svg>
                {#
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle icon" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                    <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                </svg>
                #}
            </button>
            <button type="button" data-bs-toggle="modal" data-bs-target="#settings" class="clean-btn">
                
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16">
                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                </svg>
                {#
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                    <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                    <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                </svg>
                #}
            </button>
        </div>
        <p>Guess the color below.</p>
        <div id="color-box">
        </div>
        <form id="input" action="/check" method="post" class="m-2">
            <div id="attempts">
                {% for attempt in attempts %}
                    <div class="inputs">
                        <p class="inline fs-1 fw-bolder align-middle mb-0" style="color: {{ attempt["color"] }}">#</p>
                        {% for digit in attempt["attempt"] %}
                            <input name="attempt" value={{ digit["value"] }} disabled class="{{ digit["correct"] }} align-middle fs-3">
                        {% endfor %}
                    </div>
                {% endfor %}
                {% if not end %}
                    <div class="inputs mb-0">
                        <p class="inline fs-1 fw-bolder align-middle mb-0">#</p>
                        <input name="1" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3" autofocus>
                        <input name="2" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3">
                        <input name="3" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3">
                        <input name="4" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3">
                        <input name="5" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3">
                        <input name="6" maxlength="1" pattern="[A-Fa-f0-9]" required autocomplete="off" class="align-middle fs-3">
                    </div>
                {% endif %}
                <div id="extra">
                    {% if limited_mode %}
                        {% for i in range(max - count - 1) %}
                            <div class="inputs">
                                <p class="inline fs-1 fw-bolder align-middle mb-0" style="color: #000">#</p>
                                {% for i in range(6) %}
                                    <input name="locked" disabled class="align-middle fs-3">
                                {% endfor %}
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
            {% if not end %}
                <button id="submit" type="submit" class="align-middle normal-btn m-2">CHECK</button>
            {% endif %}
        </form>
        <!-- Keyboard -->
        <div id="keyboard">
            <div id="numbers" class="m-1">
                <button id="1" class="key normal-btn" type="button">1</button>
                <button id="2" class="key normal-btn" type="button">2</button>
                <button id="3" class="key normal-btn" type="button">3</button>
                <button id="4" class="key normal-btn" type="button">4</button>
                <button id="5" class="key normal-btn" type="button">5</button>
                <button id="6" class="key normal-btn" type="button">6</button>
                <button id="7" class="key normal-btn" type="button">7</button>
                <button id="8" class="key normal-btn" type="button">8</button>
                <button id="9" class="key normal-btn" type="button">9</button>
                <button id="0" class="key normal-btn" type="button">0</button>
            </div>
            <div id="letters" class="m-1">
                <button id="A" class="key normal-btn" type="button">A</button>
                <button id="B" class="key normal-btn" type="button">B</button>
                <button id="C" class="key normal-btn" type="button">C</button>
                <button id="D" class="key normal-btn" type="button">D</button>
                <button id="E" class="key normal-btn" type="button">E</button>
                <button id="F" class="key normal-btn" type="button">F</button>
                <button id="backspace" class="key normal-btn" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-backspace icon" viewBox="0 0 16 16">
                        <path d="M5.83 5.146a.5.5 0 0 0 0 .708L7.975 8l-2.147 2.146a.5.5 0 0 0 .707.708l2.147-2.147 2.146 2.147a.5.5 0 0 0 .707-.708L9.39 8l2.146-2.146a.5.5 0 0 0-.707-.708L8.683 7.293 6.536 5.146a.5.5 0 0 0-.707 0z"/>
                        <path d="M13.683 1a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-7.08a2 2 0 0 1-1.519-.698L.241 8.65a1 1 0 0 1 0-1.302L5.084 1.7A2 2 0 0 1 6.603 1zm-7.08 1a1 1 0 0 0-.76.35L1 8l4.844 5.65a1 1 0 0 0 .759.35h7.08a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z"/>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Instructions -->
        <div class="modal fade" id="instructions" tabindex="-1" aria-labelledby="instructions-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="instructions-label">How To Play</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Try to guess the hexcode of the color in the box. 
                            If you don't know what a hexcode is, it is basically a 6-digit representation of a color. 
                            Valid digits are from A-F and all numerical digits.
                        </p>
                        <p>
                            Enter your guess in the cells below, and press check to see how you do.
                            Cells highlighted in green indicate that the digit you guessed at that position is correct.
                            Cells highlighted in yellow indicate that the digit is in the hexcode, but not in the correct position.
                            Cells in gray are not in the hexcode.
                            You have unlimited attempts to guess the color.
                        </p>
                        <p>
                            Good luck!
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Settings -->
        <div class="modal fade" id="settings" tabindex="-1" aria-labelledby="settings-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="settings-label">Settings</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column align-items-center justify-items-center">
                        <form id="settings-container">
                            <div class="form-check form-switch form-check-reverse">
                                <label class="form-check-label" for="switchGuessMode">Limited guesses</label>
                                <input class="form-check-input" type="checkbox" role="switch" id="switchGuessMode" name="limitedMode" {% if limited_mode %}checked{% endif %}>
                            </div>
                            <div class="form-check form-switch form-check-reverse">
                                <label class="form-check-label" for="switchDarkMode">Dark mode</label>
                                <input class="form-check-input" type="checkbox" role="switch" id="switchDarkMode" name="darkMode" {% if dark_mode %}checked{% endif %}>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% if victory %}
            <!-- Victory -->
            <div class="modal fade" id="victory" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="victory-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <h1 class="modal-title fs-5" id="victory-label">Congratulations!</h1>
                        </div>
                        <div class="modal-body">
                            <p>You guessed the color <span id="color">{{ color }}</span> in {{ count }} guess{% if count > 1 %}es{% endif %}!</p>
                            <p>Here's how you did:</p>
                            {% for attempt in attempts %}
                                <div>
                                    {% for digit in attempt["attempt"] %}
                                    <div class="inline-square {{ digit["correct"] }}"></div>
                                    {% endfor%}
                                </div>
                            {% endfor %}
                        </div>
                        <div class="modal-footer justify-content-center">
                            <form action="/new" method="get">
                                <button type="submit" class="normal-btn">Play Again</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        {% if end and not victory %}
            <!-- Loss -->
            <div class="modal fade" id="loss" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loss-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header justify-content-center">
                            <h1 class="modal-title fs-5" id="loss-label">Sorry, you're out of guesses</h1>
                        </div>
                        <div class="modal-body">
                            <p>The color was <span id="color">{{ color }}</span>.</p>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <form action="/new" method="get">
                                <button type="submit" class="normal-btn">Play Again</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block embedded %}
    <style>
        #color-box {
            background-color: {{ color }};
        }

        #color {
            color: {{ color }};
        }
    </style>
    <script type="text/javascript">
        const keys = document.querySelectorAll('.key');
        const key_classes = JSON.parse('{{ key_classes|tojson }}');

        keys.forEach((key) => {
            if (key_classes[key.id])
            {
                key.classList.add(key_classes[key.id]);
            }
        });

        {% if victory %}
            const victory_page = new bootstrap.Modal(document.getElementById('victory'), {});
            victory_page.show();
        {% endif %}
        {% if end and not victory %}
            const losing_page = new bootstrap.Modal(document.getElementById('loss'), {});
            losing_page.show();
        {% endif %}
    </script>
{% endblock %}